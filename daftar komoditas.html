<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daftar Komoditas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Animasi fade-in */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        /* Gradient background untuk header */
        .gradient-bg {
            background: linear-gradient(135deg, #F77E04, #F70404);
        }

        /* Warna tombol yang lebih cerah */
        .btn-primary {
            background: linear-gradient(135deg, #3B82F6, #1D4ED8);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }

        /* Efek hover pada tabel */
        .hover-effect:hover {
            background-color: #f3f4f6;
        }

        /* Gaya untuk logo di header */
        .logo-header {
            height: 60px; /* Sesuaikan ukuran logo */
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
            transition: transform 0.3s ease;
        }

        /* Efek hover untuk logo */
        .logo-header:hover {
            transform: scale(1.05);
        }

        /* Media Query untuk perangkat mobile (lebar layar <= 768px) */
        @media (max-width: 768px) {
            .logo-header {
                height: 40px; /* Ukuran diperkecil untuk mobile */
            }
        }

        /* Flexbox untuk memastikan footer tetap di bawah */
        html, body {
            height: 100%;
            margin: 0;
        }

        body {
            display: flex;
            flex-direction: column;
        }

        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        footer {
            flex-shrink: 0;
        }

        /* Perluas tabel hingga ke batas bawah */
        .table-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0; /* Agar tabel bisa scroll */
        }

        /* Gaya untuk tabel wrapper */
        .table-wrapper {
            flex: 1;
            overflow-y: auto; /* Agar tabel bisa scroll jika kontennya panjang */
            max-height: 400px; /* Batasi tinggi maksimum tabel */
        }

        .table-wrapper table {
            width: 100%;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-900">
    <!-- Container Utama -->
    <div class="container mx-auto p-4 pt-8">
        <!-- Header -->
        <header class="gradient-bg text-white py-8 rounded-lg shadow-lg mb-6 fade-in relative flex items-center justify-between px-6">
            <!-- Menu di Pojok Kiri -->
            <div class="header-menu">
                <div class="relative">
                    <button id="menuButton" class="btn-primary">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div id="menuDropdown" class="hidden">
                        <a href="index.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-100"><i class="fas fa-home mr-2"></i>Beranda</a>
                        <a href="daftar_komoditas.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-100"><i class="fas fa-newspaper mr-2"></i>Daftar Komoditas</a>
                        <a href="tentang.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-100"><i class="fas fa-info-circle mr-2"></i>Tentang Kami</a>
                        <a href="kontak.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-100"><i class="fas fa-envelope mr-2"></i>Kontak</a>
                    </div>
                </div>
            </div>

            <!-- Judul di Tengah -->
            <div class="text-center flex-grow mx-4">
                <h1 class="text-4xl font-bold">Daftar Komoditas</h1>
                <p class="mt-2 text-lg opacity-90">Daftar komoditas dan desa yang memilikinya</p>
            </div>

            <!-- Logo di Kanan -->
            <div class="logo-container flex flex-col items-center justify-center">
                <img src="logo.png" alt="Logo Bhinneka Tunggal Ika" class="logo-header">
            </div>
        </header>

        <!-- Fitur Pencarian -->
        <div class="mb-6">
            <label class="block text-sm font-medium text-secondary mb-2">Cari Komoditas</label>
            <input type="text" id="searchKomoditas" placeholder="Masukkan nama komoditas..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-white text-gray-900">
        </div>

        <!-- Dua Tabel (Kiri dan Kanan) -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 table-container">
            <!-- Tabel Kiri: Daftar Komoditas -->
            <div class="bg-white p-6 rounded-lg shadow-lg fade-in flex flex-col">
                <h2 class="text-2xl font-semibold text-primary mb-4">Daftar Komoditas</h2>
                <div class="table-wrapper">
                    <table class="min-w-full bg-white">
                        <thead>
                            <tr>
                                <th class="py-2 px-4 border-b">Nama Komoditas</th>
                            </tr>
                        </thead>
                        <tbody id="komoditasTable">
                            <!-- Data komoditas akan dimasukkan di sini secara dinamis -->
                            <tr id="noKomoditasData">
                                <td class="py-2 px-4 border-b text-center">Tidak ada data komoditas</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tabel Kanan: Daftar Desa -->
            <div class="bg-white p-6 rounded-lg shadow-lg fade-in flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold text-primary">Desa dengan Komoditas Terpilih</h2>
                    <div id="selectedKomoditas" class="text-lg font-semibold text-gray-700"></div>
                </div>
                <div class="table-wrapper">
                    <table class="min-w-full bg-white">
                        <thead>
                            <tr>
                                <th class="py-2 px-4 border-b">Nama Desa</th>
                                <th class="py-2 px-4 border-b">Kabupaten</th>
                                <th class="py-2 px-4 border-b">Kecamatan</th>
                            </tr>
                        </thead>
                        <tbody id="desaTable">
                            <!-- Data desa akan dimasukkan di sini secara dinamis -->
                            <tr id="noDesaData">
                                <td class="py-2 px-4 border-b text-center" colspan="3">Tidak ada data desa</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="text-center py-4 bg-gray-800 text-white mt-8">
        <p class="text-sm">
            Dibuat oleh <a href="https://www.facebook.com/profile.php?id=100079076676302" target="_blank" class="text-blue-400 hover:text-blue-300 underline">Ardiansyah/Ancang</a> Pasir Mayang
        </p>
    </footer>

    <script>
        // Fungsi untuk mengambil daftar komoditas dari API
        async function fetchKomoditas() {
            const response = await fetch('http://localhost/paser_komoditas/api.php?action=get_komoditas');
            return await response.json();
        }

        // Fungsi untuk mengambil daftar desa berdasarkan komoditas dari API
        async function fetchDesa(komoditas) {
            const response = await fetch(`http://localhost/paser_komoditas/api.php?action=get_desa&komoditas=${komoditas}`);
            return await response.json();
        }

        // Fungsi untuk mengambil data dari data.geojson
        async function fetchGeoJSON() {
            const response = await fetch('data.geojson');
            return await response.json();
        }

        // Fungsi untuk mencocokkan desa dari database dengan data.geojson
        async function matchDesaWithGeoJSON(desaList) {
            const geojsonData = await fetchGeoJSON(); // Ambil data dari data.geojson
            const matchedDesa = desaList.map(desa => {
                const matched = geojsonData.features.find(feature => feature.properties.name === desa);
                if (matched) {
                    return {
                        name: desa,
                        kabupaten: matched.properties['is_in:region'],
                        kecamatan: matched.properties['is_in:county']
                    };
                } else {
                    return {
                        name: desa,
                        kabupaten: 'Tidak Diketahui',
                        kecamatan: 'Tidak Diketahui'
                    };
                }
            });
            return matchedDesa;
        }

        // Fungsi untuk menampilkan daftar komoditas di tabel kiri
        async function renderKomoditasTable(filter = "") {
            const komoditasTable = document.getElementById('komoditasTable');
            const noKomoditasData = document.getElementById('noKomoditasData');
            komoditasTable.innerHTML = ''; // Kosongkan tabel

            try {
                const komoditas = await fetchKomoditas(); // Ambil data komoditas dari API
                const filteredKomoditas = komoditas.filter(k => k.toLowerCase().includes(filter.toLowerCase())); // Filter berdasarkan input pencarian

                if (filteredKomoditas.length > 0) {
                    // Batasi hanya 11 baris yang ditampilkan
                    const limitedKomoditas = filteredKomoditas.slice(0, 11);

                    limitedKomoditas.forEach(k => {
                        const row = document.createElement('tr');
                        row.className = 'hover-effect cursor-pointer';
                        row.innerHTML = `
                            <td class="py-2 px-4 border-b">${k}</td>
                        `;
                        row.addEventListener('click', async () => {
                            const desa = await fetchDesa(k); // Ambil data desa dari database
                            const matchedDesa = await matchDesaWithGeoJSON(desa); // Cocokkan dengan data.geojson
                            renderDesaTable(matchedDesa, k); // Tampilkan data desa di tabel kanan dengan nama komoditas
                        });
                        komoditasTable.appendChild(row);
                    });

                    // Jika ada lebih dari 11 baris, tampilkan pesan
                    if (filteredKomoditas.length > 11) {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td class="py-2 px-4 border-b text-center">...</td>
                        `;
                        komoditasTable.appendChild(row);
                    }
                } else {
                    // Tampilkan pesan jika tidak ada data yang cocok
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="py-2 px-4 border-b text-center">Tidak ada data yang cocok</td>
                    `;
                    komoditasTable.appendChild(row);
                }
            } catch (error) {
                console.error('Gagal mengambil data komoditas:', error);
                komoditasTable.appendChild(noKomoditasData);
            }
        }

        // Fungsi untuk menampilkan daftar desa di tabel kanan
        function renderDesaTable(desa, komoditas) {
            const desaTable = document.getElementById('desaTable');
            const noDesaData = document.getElementById('noDesaData');
            const selectedKomoditasElement = document.getElementById('selectedKomoditas');
            desaTable.innerHTML = ''; // Kosongkan tabel

            // Tampilkan nama komoditas yang dipilih
            selectedKomoditasElement.textContent = komoditas;

            if (desa.length > 0) {
                // Batasi hanya 11 baris yang ditampilkan
                const limitedDesa = desa.slice(0, 11);

                limitedDesa.forEach(d => {
                    const row = document.createElement('tr');
                    row.className = 'hover-effect';
                    row.innerHTML = `
                        <td class="py-2 px-4 border-b">${d.name}</td>
                        <td class="py-2 px-4 border-b">${d.kabupaten}</td>
                        <td class="py-2 px-4 border-b">${d.kecamatan}</td>
                    `;
                    desaTable.appendChild(row);
                });

                // Jika ada lebih dari 11 baris, tampilkan pesan
                if (desa.length > 11) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="py-2 px-4 border-b text-center" colspan="3">...</td>
                    `;
                    desaTable.appendChild(row);
                }
            } else {
                desaTable.appendChild(noDesaData);
            }
        }

        // Event listener untuk pencarian komoditas
        document.getElementById('searchKomoditas').addEventListener('input', function () {
            const searchQuery = this.value.trim();
            renderKomoditasTable(searchQuery); // Perbarui tabel komoditas berdasarkan pencarian
        });

        // Render tabel komoditas saat halaman dimuat
        document.addEventListener('DOMContentLoaded', () => {
            renderKomoditasTable();
        });
    </script>
</body>
</html>