<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PASER KOMODITAS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        /* Custom CSS untuk animasi dan efek */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        .hover-scale {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .hover-scale:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }

        .gradient-bg {
            background: linear-gradient(135deg, #6EE7B7, #3B82F6);
        }

        .sidebar {
            background: rgba(255, 255, 255, 0.95); /* Lebih solid */
            backdrop-filter: blur(5px); /* Opsional */
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .map-container {
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            overflow: hidden;
        }

        .leaflet-marker-icon:hover {
            transform: scale(1.2);
            transition: transform 0.3s ease;
        }

        /* Responsif untuk mobile */
        @media (max-width: 640px) {
            .header h1 {
                font-size: 1.5rem; /* Ukuran font lebih kecil */
            }

            .sidebar {
                padding: 10px; /* Padding lebih kecil */
            }

            #map {
                height: 50vh; /* Tinggi peta lebih kecil */
            }
        }

        /* Responsif untuk desktop */
        @media (min-width: 1024px) {
            .sidebar {
                width: 25%; /* Lebar sidebar lebih kecil */
            }

            #map {
                height: 70vh; /* Tinggi peta lebih besar */
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto p-4">
        <!-- Header -->
        <header class="gradient-bg text-white text-center py-6 rounded-lg shadow-lg mb-6 fade-in">
            <h1 class="text-3xl font-bold">PASER KOMODITAS</h1>
            <p class="mt-2 text-sm opacity-80">Visualisasi Data Komoditas di Paser</p>
            <a href="daftar-komoditas.html" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-all mt-4 inline-block">
                Lihat Daftar Komoditas
            </a>
        </header>

        <!-- Main Content -->
        <div class="flex flex-col lg:flex-row gap-6">
            <!-- Sidebar -->
            <aside class="sidebar w-full lg:w-1/3 p-6 rounded-lg shadow-lg hover-scale fade-in">
                <button id="toggleFilter" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-all">
                    Tampilkan Filter
                </button>

                <div id="filterSection" class="hidden mt-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Filter Kecamatan</label>
                    <select id="filterKecamatan" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        <option value="">Semua Kecamatan</option>
                        <option value="kecamatan1">Kecamatan 1</option>
                        <option value="kecamatan2">Kecamatan 2</option>
                        <option value="kecamatan3">Kecamatan 3</option>
                    </select>

                    <label class="block text-sm font-medium text-gray-700 mt-4 mb-2">Filter Komoditas</label>
                    <select id="filterKomoditas" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        <option value="">Semua Komoditas</option>
                        <option value="Padi">Padi</option>
                        <option value="Jagung">Jagung</option>
                        <option value="Kopi">Kopi</option>
                        <option value="Ikan">Ikan</option>
                    </select>

                    <label class="block text-sm font-medium text-gray-700 mt-4 mb-2">Filter Industri</label>
                    <select id="filterIndustri" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        <option value="">Semua Industri</option>
                        <option value="Pertanian">Pertanian</option>
                        <option value="Perkebunan">Perkebunan</option>
                        <option value="Perikanan">Perikanan</option>
                    </select>
                </div>

                <!-- Tabel Informasi -->
                <div id="infoTable" class="mt-6 hidden">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Data Komoditas</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full bg-white rounded-lg shadow">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Desa</th>
                                    <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Komoditas</th>
                                    <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Industri</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                <!-- Data akan dimasukkan di sini -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Fitur Pencarian -->
                <input type="text" id="searchInput" placeholder="Cari desa atau komoditas..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all mb-4">

                <!-- Tombol Ekspor Data -->
                <button id="exportButton" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-all">
                    Ekspor Data ke CSV
                </button>
            </aside>

            <!-- Peta -->
            <div class="w-full lg:w-2/3 map-container fade-in">
                <div id="map" class="w-full h-96 lg:h-[70vh] rounded-lg"></div>
            </div>
        </div>
    </div>

    <script>
        // Data contoh desa dan komoditas
        const dataDesa = [
            { nama: "Desa A", komoditas: "Padi", industri: "Pertanian", kecamatan: "kecamatan1", lat: -1.9167, lng: 116.1667 },
            { nama: "Desa B", komoditas: "Jagung", industri: "Pertanian", kecamatan: "kecamatan2", lat: -1.9267, lng: 116.1767 },
            { nama: "Desa C", komoditas: "Kopi", industri: "Perkebunan", kecamatan: "kecamatan3", lat: -1.9367, lng: 116.1867 },
            { nama: "Desa D", komoditas: "Ikan", industri: "Perikanan", kecamatan: "kecamatan1", lat: -1.9467, lng: 116.1967 },
        ];

        // Fungsi untuk mendapatkan ikon berdasarkan komoditas
        function getIcon(komoditas) {
            let iconUrl;
            switch (komoditas) {
                case 'Padi':
                    iconUrl = 'https://cdn-icons-png.flaticon.com/512/2972/2972035.png'; // Contoh URL ikon padi
                    break;
                case 'Jagung':
                    iconUrl = 'https://cdn-icons-png.flaticon.com/512/2972/2972045.png'; // Contoh URL ikon jagung
                    break;
                case 'Kopi':
                    iconUrl = 'https://cdn-icons-png.flaticon.com/512/2972/2972055.png'; // Contoh URL ikon kopi
                    break;
                case 'Ikan':
                    iconUrl = 'https://cdn-icons-png.flaticon.com/512/2972/2972065.png'; // Contoh URL ikon ikan
                    break;
                default:
                    iconUrl = 'https://cdn-icons-png.flaticon.com/512/2972/2972075.png'; // Ikon default
            }
            return L.icon({
                iconUrl: iconUrl,
                iconSize: [32, 32], // Ukuran ikon
                iconAnchor: [16, 32], // Titik anchor ikon
            });
        }

        // Inisialisasi Peta
        var map = L.map('map').setView([-1.9167, 116.1667], 10);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // Fungsi untuk menambahkan marker ke peta
        function addMarker(desa) {
            const icon = getIcon(desa.komoditas);
            const marker = L.marker([desa.lat, desa.lng], { icon })
                .addTo(map)
                .bindPopup(`<b>${desa.nama}</b><br>Komoditas: ${desa.komoditas}<br>Industri: ${desa.industri}`);

            marker.on('click', function() {
                marker.setIcon(L.icon({
                    iconUrl: 'https://cdn-icons-png.flaticon.com/512/2972/2972075.png', // Ikon saat diklik
                    iconSize: [40, 40],
                    iconAnchor: [20, 40],
                }));
            });
        }

        // Fungsi untuk memfilter data
        function filterData(kecamatan, komoditas, industri, filteredData = dataDesa) {
            // Hapus semua marker yang ada
            map.eachLayer(layer => {
                if (layer instanceof L.Marker) {
                    map.removeLayer(layer);
                }
            });

            // Filter data berdasarkan kecamatan, komoditas, dan industri
            filteredData.forEach(desa => {
                const matchKecamatan = !kecamatan || desa.kecamatan === kecamatan;
                const matchKomoditas = !komoditas || desa.komoditas === komoditas;
                const matchIndustri = !industri || desa.industri === industri;

                if (matchKecamatan && matchKomoditas && matchIndustri) {
                    addMarker(desa);
                }
            });

            // Perbarui tabel
            updateTable(kecamatan, komoditas, industri, filteredData);
        }

        // Fungsi untuk menampilkan data di tabel
        function updateTable(kecamatan, komoditas, industri, filteredData = dataDesa) {
            const tableBody = document.querySelector('#infoTable tbody');
            tableBody.innerHTML = ''; // Kosongkan tabel

            filteredData.forEach(desa => {
                const matchKecamatan = !kecamatan || desa.kecamatan === kecamatan;
                const matchKomoditas = !komoditas || desa.komoditas === komoditas;
                const matchIndustri = !industri || desa.industri === industri;

                if (matchKecamatan && matchKomoditas && matchIndustri) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-4 py-2">${desa.nama}</td>
                        <td class="px-4 py-2">${desa.komoditas}</td>
                        <td class="px-4 py-2">${desa.industri}</td>
                    `;
                    tableBody.appendChild(row);
                }
            });

            // Tampilkan tabel jika ada data
            document.getElementById('infoTable').classList.toggle('hidden', tableBody.innerHTML === '');
        }

        // Event listener untuk tombol toggle filter
        document.getElementById('toggleFilter').addEventListener('click', function() {
            const filterSection = document.getElementById('filterSection');
            filterSection.classList.toggle('hidden');
        });

        // Event listener untuk filter
        document.getElementById('filterKecamatan').addEventListener('change', applyFilters);
        document.getElementById('filterKomoditas').addEventListener('change', applyFilters);
        document.getElementById('filterIndustri').addEventListener('change', applyFilters);

        function applyFilters() {
            const selectedKecamatan = document.getElementById('filterKecamatan').value;
            const selectedKomoditas = document.getElementById('filterKomoditas').value;
            const selectedIndustri = document.getElementById('filterIndustri').value;

            filterData(selectedKecamatan, selectedKomoditas, selectedIndustri);
        }

        // Event listener untuk fitur pencarian
        document.getElementById('searchInput').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const filteredData = dataDesa.filter(desa => 
                desa.nama.toLowerCase().includes(searchTerm) || 
                desa.komoditas.toLowerCase().includes(searchTerm)
            );

            // Perbarui peta dan tabel dengan data yang difilter
            filterData('', '', '', filteredData);
        });

        // Event listener untuk tombol ekspor data
        document.getElementById('exportButton').addEventListener('click', function() {
            const csvContent = "data:text/csv;charset=utf-8," 
                + dataDesa.map(desa => `${desa.nama},${desa.komoditas},${desa.industri}`).join("\n");
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "daftar_komoditas.csv");
            document.body.appendChild(link);
            link.click();

            // Notifikasi
            Swal.fire({
                icon: 'success',
                title: 'Data Berhasil Diekspor',
                text: 'File CSV telah berhasil diunduh.',
            });
        });

        // Tambahkan semua marker saat halaman pertama kali dimuat
        dataDesa.forEach(desa => addMarker(desa));
    </script>
</body>
</html>